#include <assert.h>
#include <stdio.h>
#include <stdlib.h>
#include <string.h>

#include "keccak256.h"

/*
Generate new test cases using https://emn178.github.io/online-tools/keccak_256.html

Run python script:
    n = 2
    line = <online output>
    str_val = str(['0x'+line[i:i+n] for i in range(0, len(line), n)])
    print(str_val.replace('\'', ''))
to get expected char arrays
*/

void keccak256_test()
{   
    size_t n_tests = 3;
    const char* test_inputs[3] = {
        "test",
        "hello world",
        "in the beginning god created the heavens and the earth"
    };
    unsigned char* expected[3] = {
        (unsigned char[32]) {0x9c, 0x22, 0xff, 0x5f, 0x21, 0xf0, 0xb8, 0x1b, 0x11, 0x3e, 0x63, 0xf7, 0xdb, 0x6d, 0xa9, 0x4f, 0xed, 0xef, 0x11, 0xb2, 0x11, 0x9b, 0x40, 0x88, 0xb8, 0x96, 0x64, 0xfb, 0x9a, 0x3c, 0xb6, 0x58},
        (unsigned char[32]) {0x47, 0x17, 0x32, 0x85, 0xa8, 0xd7, 0x34, 0x1e, 0x5e, 0x97, 0x2f, 0xc6, 0x77, 0x28, 0x63, 0x84, 0xf8, 0x02, 0xf8, 0xef, 0x42, 0xa5, 0xec, 0x5f, 0x03, 0xbb, 0xfa, 0x25, 0x4c, 0xb0, 0x1f, 0xad},
        (unsigned char[32]) {0x6c, 0x12, 0x05, 0xce, 0xd0, 0x22, 0x98, 0x61, 0x0c, 0x7c, 0x4a, 0xc9, 0x6e, 0xc8, 0xc7, 0x80, 0xed, 0x7a, 0x9f, 0xd7, 0x77, 0xd5, 0x70, 0x47, 0xac, 0x3b, 0x17, 0x40, 0x2f, 0x09, 0xf1, 0x53}
    };

    for (int i = 0; i < n_tests; i++) {
        const char* input = test_inputs[i];
        unsigned char* output = keccak_256(strlen(input), input);
        printf("test string: %s\n", input);
        printf("output: ");        
        for (size_t j = 0; j < 32; j++) {
            printf("%02x", output[j]);
            assert(output[j] == expected[i][j]);
        }
        printf("\n");
    }
}